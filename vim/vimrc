" +===============+
" |  Environment  |
" +===============+

scriptencoding utf-8
set background=dark
set colorcolumn=81
set complete=.,b,u
set completeopt=menu,preview
set directory=/tmp
set fcs=vert:│
set fileencoding=utf-8
set foldmethod=syntax
set hidden
set hlsearch
set ignorecase
set lazyredraw
set list
set listchars=tab:┄\ ,trail:·
set mouse=a
set nobackup
set nofoldenable
set noswapfile
set nowritebackup
set number
set pastetoggle=<leader>P
set relativenumber
set shiftwidth=2
set shortmess+=c
set signcolumn=yes
set smartcase
set smartindent
set splitbelow
set splitright
set synmaxcol=500
set tabstop=2
set termguicolors
set ttyfast
set updatetime=300
set wildignore+=.cache,.git,build,dist,node_modules,vendor
set wildmode=longest,list:longest


" +================================+
" |  Select vim-sensible settings  |
" +================================+

set autoindent
set autoread
set backspace=indent,eol,start
set display+=lastline
set encoding=utf-8
set formatoptions+=j " Delete comment character when joining commented lines
set history=1000
set incsearch
set laststatus=2
set nrformats-=octal
set ruler
set scrolloff=1
set sessionoptions-=options
set sidescrolloff=5
set smarttab
set tabpagemax=50
set ttimeout
set ttimeoutlen=100
set viminfo^=!
set wildmenu
set viewoptions-=options


" +===========+
" |  Plugins  |
" +===========+

call plug#begin()

" set working directory to git project root
Plug 'airblade/vim-rooter'

" end whitespace wars
Plug 'editorconfig/editorconfig-vim'

" colorscheme
Plug 'gruvbox-community/gruvbox'
let g:gruvbox_contrast_dark="hard"
let g:gruvbox_sign_column="bg0"

" lightweight statusline
Plug 'itchyny/lightline.vim'
Plug 'maximbaz/lightline-ale' " lint status
let g:lightline={
	\ 'active': {
	\   'left': [ [ 'mode', 'paste' ],
	\             [ 'gitbranch' ],
	\             [ 'relativepath', 'modified' ] ],
	\   'right': [ [ 'lineinfo' ],
	\              [ 'linter_warnings', 'linter_errors', 'linter_ok' ],
	\              [ 'filetype' ] ]
	\ },
	\ 'colorscheme': 'gruvbox',
	\ 'component_expand': {
	\   'linter_warnings': 'lightline#ale#warnings',
	\   'linter_errors': 'lightline#ale#errors',
	\   'linter_ok': 'lightline#ale#ok'
	\ },
	\ 'component_function': {
	\   'gitbranch': 'fugitive#head'
	\ },
	\ 'component_type': {
	\   'linter_errors': 'error',
	\   'linter_warnings': 'warning'
	\ },
	\ }
let g:lightline#ale#indicator_errors='x'
let g:lightline#ale#indicator_warnings='~'

" run tests from vim
Plug 'janko/vim-test'
let g:test#strategy='vimterminal'

" fuzzy finder
Plug 'junegunn/fzf'
Plug 'junegunn/fzf.vim'
let $FZF_DEFAULT_COMMAND='ag -g "" --hidden --ignore .git'
let $FZF_DEFAULT_OPTS="--exact --bind ctrl-a:select-all"
nnoremap <leader>b :Buffers<cr>
nnoremap <leader>c :Commands<cr>
nnoremap <leader>h :History<cr>
nnoremap <leader>p :Files<cr>
nnoremap <leader>/ :call fzf#vim#ag('', {'options': '--delimiter : --nth 4..'})<cr>
nnoremap <leader># :call fzf#vim#ag('', {'options': '-q ' . shellescape(expand('<cword>')) . ' --delimiter : --nth 4..'})<cr>

" sidebar to preview register contents
Plug 'junegunn/vim-peekaboo'

" sane file browsing, requires nnn
Plug 'mcchrish/nnn.vim'
let g:nnn#action={ '<c-v>': 'vsplit' }
let g:nnn#set_default_mappings=0
nnoremap <silent> - :NnnPicker '%:p:h'<cr><cr>
nnoremap <silent> _ :NnnPicker<cr>

" git gutter
Plug 'mhinz/vim-signify'
let g:signify_vcs_list=['git']

" meta-package for syntax highlighting
Plug 'sheerun/vim-polyglot'

" comment / uncomment
Plug 'tpope/vim-commentary'

" shell helpers
Plug 'tpope/vim-eunuch'

" git
Plug 'tpope/vim-fugitive'
nnoremap <leader>g :Gstatus<cr>
nnoremap <leader>d :Gvdiff<cr>

" repeat more actions with .
Plug 'tpope/vim-repeat'

" more previous / next commands with []
Plug 'tpope/vim-unimpaired'

" linting
Plug 'w0rp/ale'
let g:ale_linters={
	\   'css':             ['stylelint'],
	\   'scss':            ['stylelint'],
	\   'dockerfile':      ['hadolint'],
	\   'javascript':      ['eslint'],
	\   'javascriptreact': ['eslint'],
	\   'typescript':      ['eslint'],
	\   'typescriptreact': ['eslint'],
	\   'lua':             ['luacheck'],
	\   'php':             ['phpcs'],
	\   'sh':              ['shellcheck'],
	\ }
let g:ale_linters_explicit=1
let g:ale_php_phpcs_standard='WordPress'
let g:ale_sign_column_always=1
let g:ale_sign_error='x'
let g:ale_sign_warning='~'

call plug#end()


" +=========+
" |  Theme  |
" +=========+

colorscheme gruvbox
highlight ColorColumn guibg=gray15
highlight SpecialKey guifg=gray30


" +==========+
" |  Remaps  |
" +==========+

" Buffers
nnoremap <leader>s :w<cr>

" Leader
nmap <space> <leader>

" Navigation
inoremap jj <esc>

" Search
nnoremap <silent> <cr> :noh<cr><cr>

" Windows
map <space><space> <c-w>
